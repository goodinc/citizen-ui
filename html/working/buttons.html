<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>Buttons / Good</title>

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="stylesheet" href="http://fast.fonts.net/cssapi/f90e5d12-8fa4-47b1-a316-b233141d7f51.css" />
  <link rel="stylesheet" href="../../assets/shared.css" />
</head>
<body class="pattern">

<section id="do">
  <h2>Do</h2>

  <form action="" method="post" class="do">
    <h6>Do It</h6>
    <p>
      <button type="submit" name="todo" value="1">I want to do this</button>
      <button type="submit" name="done" value="1">I did this</button>
    </p>
  </form>

  <form action="" method="post" class="doing">
    <h6>To Do</h6>
    <p>
      <button type="submit" name="done" value="1">I did this</button>
      <button type="submit" name="remove" value="1">Remove</button>
    </p>
  </form>

  <form action="" method="post" class="done">
    <h6>Done</h6>
    <p>
      <button type="submit" name="remove" value="1">Remove</button>
    </p>
  </form>

  <script type="text/template" class="do-template">
    <form action="" method="post" class="do">
      <h6>Do It</h6>
      <p>
        <button type="submit" name="todo" value="1">I want to do this</button>
        <button type="submit" name="done" value="1">I did this</button>
      </p>
    </form>
  </script>

  <script type="text/template" class="doing-template">
    <form action="" method="post" class="doing">
      <h6>To Do</h6>
      <p>
        <button type="submit" name="done" value="1">I did this</button>
        <button type="submit" name="remove" value="1">Remove</button>
      </p>
    </form>
  </script>

  <script type="text/template" class="done-template">
    <form action="" method="post" class="done">
      <h6>Done</h6>
      <p>
        <button type="submit" name="remove" value="1">Remove</button>
      </p>
    </form>
  </script>

  <script type="text/template" class="loading-template">
    <span class="loading"></span> Loadingâ€¦
  </script>

</section>

<section id="follow">
  <h2>Follow</h2>

  <form action="" method="post" class="follow">
    <p><button type="submit">Follow</button></p>
  </form>

  <form action="" method="post" class="following">
    <p><button type="submit">Unfollow</button></p>
  </form>
</section>

<script src="../../assets/shared.js"></script>

<script>

(function() {


  /* This starts everything
  ----------------------------------------------- */
  function start() {

    // OPTIONAL: Submit the do button data using AJAX
    new DoAjax();

  }


  /* =DoAjax
  ----------------------------------------------- */
  var DoAjax = function() {};

  (function() {

    if (!document.body.addEventListener || !document.querySelector) return;

    DoAjax = function() {

      function delegate(e) {
        var target = e.target;

        var types = ["doing", "done", "do"];

        var type;
        for (var index = 0; index < types.length; index++) {
          if (target.className.indexOf(types[index]) >= 0) {
            type = types[index + 1] || types[0];
            console.log("type: " + type);
            break;
          }
        }

        if (type) {

          /*
          setTimeout(function() {
            var template = document.body.querySelector("." + type + "-template");
            console.log(type + "-template: " + template);
            var temp = document.createElement("div");
            temp.innerHTML = template.innerHTML;
            form = temp.querySelector("form");
            form.parentNode.removeChild(form);
            target.parentNode.insertBefore(form, target);
            target.parentNode.removeChild(target);
          }, 200);
          */

          function clone(a, b) {
            b.innerHTML = a.innerHTML;
          }

          setTimeout(function() {
            var template = document.body.querySelector("." + type + "-template");
            console.log(type + "-template: " + template);
            var temp = document.createElement("div");
            temp.innerHTML = template.innerHTML;
            form = temp.querySelector("form");
            target.className = form.className;
            clone(form.querySelector("h6"), target.querySelector("h6"));
            clone(form.querySelector("p"), target.querySelector("p"));
          }, 500);

          setTimeout(function() {
            var loading = document.createElement("span");
            loading.className = "loading";
            target.querySelector("p").appendChild(loading);
          }, 50);

          e.preventDefault();

        }
      }

      document.body.addEventListener("submit", delegate, false);

    };
      
  })();


  /* Everything is ready, so start it up
  ----------------------------------------------- */
  start();


})();


</script>

</body>
</html>
